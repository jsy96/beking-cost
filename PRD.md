# 成本核算系统 - 产品需求文档（PRD）

## 一、项目概述

**目标**：创建一个最小可行的成本核算系统，通过飞书多维表格存储数据。

**用户**：需要追踪原料采购、产品配方、销售利润的小型商家/个人。

---

## 二、功能范围（MVP）

### 2.1 核心功能（3个）

| 功能 | 描述 |
|------|------|
| **原料采购记录** | 记录采购的原料、数量、单价、总价、日期 |
| **产品配方管理** | 定义产品所需的原料和用量，自动计算单位成本 |
| **销售记录** | 记录销售的产品、数量、金额，自动计算利润 |

### 2.2 数据存储

使用飞书多维表格存储，3个数据表：

| 表名 | 字段 |
|------|------|
| 原料采购 | 原料名称、采购数量、采购单价、采购总价、采购日期 |
| 产品配方 | 产品名称、制作数量、原料组成(JSON)、单位成本 |
| 商品销售 | 销售日期、产品名称、销售数量、销售总额、利润 |

---

## 三、用户流程

### 3.1 配置流程
1. 首次访问，显示配置面板
2. 输入飞书 App ID、App Secret、Sheet Token
3. 点击保存，自动创建3个数据表

### 3.2 日常使用流程
```
1. 录入原料采购 → 2. 配置产品配方 → 3. 记录销售 → 4. 查看利润
```

---

## 四、页面设计

### 4.1 布局
- 顶部：配置按钮 + 当前状态显示
- 中间：3个标签页（原料采购 | 产品配方 | 商品销售）
- 底部：简单的利润统计

### 4.2 交互方式
- 每个表格：新增按钮 + 数据列表 + 编辑/删除操作
- 表单：弹窗式，填写后保存

---

## 五、技术方案

### 5.1 技术栈
- **前端**：纯 HTML + CSS + JavaScript（无框架）
- **后端**：Vercel Serverless 函数（代理飞书API）
- **存储**：飞书多维表格

### 5.2 API设计
- `/api/feishu/*` - 代理所有飞书API请求
- 前端通过代理服务器调用飞书API，避免CORS问题

### 5.3 字段类型
- 文本：`type: 1`
- 数字：`type: 2`
- 日期：`type: 5`（使用毫秒时间戳）

---

## 六、数据流程

```
用户操作 → 前端验证 → 调用飞书API → 更新多维表格 → 刷新显示
```

---

## 七、验收标准

- [ ] 可以配置飞书API并自动创建3个表
- [ ] 可以新增、编辑、删除原料采购记录
- [ ] 可以新增、编辑、删除产品配方
- [ ] 可以新增、编辑、删除销售记录
- [ ] 可以查看简单的利润统计（总销售额、总成本、总利润）

---

## 八、开发计划

| 步骤 | 内容 |
|------|------|
| 1 | 创建基础HTML页面 + 样式 |
| 2 | 实现飞书API代理（Vercel） |
| 3 | 实现配置保存和表格初始化 |
| 4 | 实现原料采购的增删改查 |
| 5 | 实现产品配方的增删改查 |
| 6 | 实现销售记录的增删改查 |
| 7 | 实现利润统计 |
| 8 | 测试和修复 |
