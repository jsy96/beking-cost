# 飞书API配置指南

## 第一步：创建飞书应用

### 1. 登录飞书开放平台
访问：https://open.feishu.cn/app

### 2. 创建企业自建应用
1. 点击「创建企业自建应用」
2. 填写应用信息：
   - 应用名称：如「成本核算系统」
   - 应用描述：随意填写
   - 应用图标：可选
3. 点击「创建」

### 3. 获取凭证信息
创建成功后，在应用页面左侧找到「凭证与基础信息」，记录：
- **App ID**：格式如 `cli_a9f19c2f80321bca`  cli_a9f19c2f80321bca
- **App Secret**：点击查看按钮获取 KqTbqhuAQ0nPnfrFzbnMGfn2naHiEOf1

---

## 第二步：配置权限

### 1. 添加权限
在应用页面左侧找到「权限管理」，搜索并添加以下权限：

| 权限名称 | 权限标识 |
|---------|---------|
| 查看、评论、编辑和管理多维表格 | `bitable:app` |
| 获取多维表格 | `bitable:app:readonly` |

### 2. 发布版本
在「版本管理与发布」中：
1. 点击「创建版本」
2. 填写版本信息后点击「保存」
3. 点击「申请发布」并「确认发布」

---

## 第三步：创建多维表格

### 1. 创建多维表格应用
1. 打开飞书客户端或网页版
2. 在左侧导航点击「多维表格」
3. 点击「新建多维表格」
4. 输入名称：如「成本核算数据」
5. 选择「空白多维表格」

### 2. 获取 Sheet Token
打开刚创建的多维表格，URL格式为：https://my.feishu.cn/base/A8OTbdPGyaApMJsxpTLc8RF5nef?table=tbldW3pQioaSu0Dl&view=vew54dMxVz
```
https://feishu.cn/base/bascnxxxxxxxxxxxxxx
```
`bascnxxxxxxxxxxxxxx` 这部分就是 **Sheet Token**  A8OTbdPGyaApMJsxpTLc8RF5nef

---

## 第四步：创建数据表

在多维表格中创建三个数据表：

### 表1：原料采购
| 字段名 | 类型 | 说明 |
|-------|------|------|
| 原料名称 | 文本 | 必填 |
| 规格 | 文本 | 如：500g/袋 |
| 采购数量 | 数字 | 必填 |
| 单位 | 文本 | 如：kg、袋 |
| 采购总价 | 数字 | 必填 |
| 采购单价 | 数字 | 自动计算 |
| 采购日期 | 日期 | 必填 |
| 供应商 | 文本 | |

### 表2：产品配方
| 字段名 | 类型 | 说明 |
|-------|------|------|
| 产品名称 | 文本 | 必填 |
| 制作数量 | 数字 | 必填 |
| 原料组成 | 文本 | 存储JSON |
| 包装成本 | 数字 | |
| 水电成本 | 数字 | |
| 单位成本 | 数字 | 自动计算 |

### 表3：商品销售
| 字段名 | 类型 | 说明 |
|-------|------|------|
| 销售日期 | 日期 | 必填 |
| 产品名称 | 文本 | 必填 |
| 销售数量 | 数字 | 必填 |
| 销售总金额 | 数字 | 必填 |
| 销售单价 | 数字 | 自动计算 |
| 单位成本 | 数字 | |
| 成本总额 | 数字 | 自动计算 |
| 利润 | 数字 | 自动计算 |

---

## 第五步：填写配置

打开网页应用，点击「设置」按钮，填写以下信息：

```
App ID:        cli_xxxxxxxxxxxxx（从第一步获取）
App Secret:    xxxxxxxxxxxxxxxxx（从第一步获取）
多维表格ID:    bascnxxxxxxxxxxxxxx（从第三步获取）
```

点击「保存配置」，系统会自动：
1. 在你的多维表格中创建三个数据表（如果不存在）
2. 初始化字段映射
3. 准备就绪后可以开始使用

---

## 常见问题

### Q: 没有企业账号怎么办？
A: 飞书开放平台需要企业账号。如果没有，可以：
- 免费注册飞书企业版（小企业免费）
- 使用个人手机号注册一个企业

### Q: 权限不足怎么办？
A: 确保在权限管理中添加了 `bitable:app` 和 `bitable:app:readonly` 权限，并发布了应用版本。

### Q: API调用失败？
A: 检查以下几点：
1. App ID 和 App Secret 是否正确
2. Sheet Token 是否正确
3. 应用是否已发布
4. 权限是否已添加并发布
5. 浏览器控制台是否有错误信息

### Q: 数据存储在飞书安全吗？
A: 飞书提供企业级安全保障，数据存储在飞书服务器。如果担心安全性，可以考虑本地存储方案。

---

## 替代方案：本地存储

如果不方便使用飞书API，我可以帮你改造为使用浏览器本地存储（LocalStorage）的版本：
- 数据保存在浏览器中
- 无需配置飞书
- 可以导出/导入数据备份
- 适合单机使用

需要的话告诉我！
